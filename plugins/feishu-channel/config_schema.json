{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://davybot.dev/schemas/feishu-channel/config",
  "title": "飞书配置",
  "description": "飞书（Lark）消息渠道插件配置",
  "type": "object",
  "properties": {
    "app_id": {
      "type": "string",
      "title": "App ID",
      "description": "飞书应用 ID",
      "minLength": 1,
      "ui:placeholder": "请输入飞书应用 App ID",
      "ui:span": 24
    },
    "app_secret": {
      "type": "string",
      "title": "App Secret",
      "description": "飞书应用 Secret（与 app_id 一起使用）",
      "minLength": 1,
      "ui:placeholder": "请输入飞书应用 App Secret",
      "ui:span": 24,
      "ui:password": true,
      "writeOnly": true
    },
    "receive_id": {
      "type": "string",
      "title": "接收者 ID",
      "description": "接收消息的飞书 ID（chat_id 或 user_id）",
      "minLength": 1,
      "ui:placeholder": "请输入群聊 ID 或用户 ID",
      "ui:span": 24
    },
    "receive_id_type": {
      "type": "string",
      "title": "接收者 ID 类型",
      "description": "receive_id 的类型",
      "enum": ["chat_id", "open_id", "user_id", "union_id"],
      "enumNames": ["群聊 ID", "用户 Open ID", "用户 ID", "Union ID"],
      "default": "chat_id",
      "ui:span": 12
    },
    "event_config": {
      "title": "事件接收配置",
      "description": "选择如何接收飞书消息事件，不同模式有不同的配置项",
      "type": "object",
      "oneOf": [
        {
          "title": "仅发送消息（不接收事件）",
          "description": "最简单的模式，插件仅用于发送消息到飞书，不会接收飞书事件",
          "properties": {
            "event_mode": {
              "title": "事件模式",
              "type": "string",
              "const": "none",
              "default": "none",
              "ui:widget": "HiddenWidget"
            }
          },
          "required": ["event_mode"]
        },
        {
          "title": "HTTP回调模式",
          "description": "使用HTTP回调接收飞书事件，需要公网URL（如ngrok或域名）",
          "properties": {
            "event_mode": {
              "title": "事件模式",
              "type": "string",
              "const": "http_callback",
              "default": "http_callback",
              "ui:widget": "HiddenWidget"
            },
            "event_server_port": {
              "type": "integer",
              "title": "事件服务器端口",
              "description": "HTTP回调模式的事件服务器端口",
              "default": 8466,
              "minimum": 1024,
              "maximum": 65535,
              "ui:span": 12
            },
            "event_server_host": {
              "type": "string",
              "title": "事件服务器监听地址",
              "description": "HTTP回调模式的事件服务器监听地址",
              "default": "0.0.0.0",
              "ui:span": 12
            },
            "encrypt_key": {
              "type": "string",
              "title": "加密 Key",
              "description": "飞书事件加密 Key（如果飞书开放平台启用了加密）",
              "ui:placeholder": "可选，如果启用了加密请填写",
              "ui:span": 24,
              "ui:password": true,
              "writeOnly": true
            }
          },
          "required": ["event_mode"]
        },
        {
          "title": "长连接模式 ⭐推荐",
          "description": "使用WebSocket长连接接收飞书事件，无需公网URL，内网环境完美支持",
          "properties": {
            "event_mode": {
              "title": "事件模式",
              "type": "string",
              "const": "long_connection",
              "default": "long_connection",
              "ui:widget": "HiddenWidget"
            },
            "encrypt_key": {
              "type": "string",
              "title": "加密 Key",
              "description": "飞书事件加密 Key（如果飞书开放平台启用了加密）",
              "ui:placeholder": "可选，如果启用了加密请填写",
              "ui:span": 24,
              "ui:password": true,
              "writeOnly": true
            }
          },
          "required": ["event_mode"]
        }
      ]
    },
    "enable_on_tool_call": {
      "type": "boolean",
      "title": "工具调用通知",
      "description": "每次工具调用时发送通知",
      "default": false,
      "ui:span": 12
    },
    "enable_on_task_complete": {
      "type": "boolean",
      "title": "任务完成通知",
      "description": "任务完成时发送通知",
      "default": true,
      "ui:span": 12
    },
    "enable_on_error": {
      "type": "boolean",
      "title": "错误通知",
      "description": "错误发生时发送通知",
      "default": true,
      "ui:span": 12
    },
    "render_mode": {
      "type": "string",
      "title": "渲染模式",
      "description": "消息渲染模式",
      "enum": ["auto", "raw", "card"],
      "enumNames": ["自动检测", "纯文本", "卡片消息"],
      "default": "auto"
    },
    "max_retries": {
      "type": "integer",
      "title": "最大重试次数",
      "description": "发送失败时的最大重试次数",
      "default": 3,
      "minimum": 0,
      "maximum": 10,
      "ui:span": 12
    },
    "retry_delay": {
      "type": "number",
      "title": "重试延迟（秒）",
      "description": "初始重试延迟（指数退避）",
      "default": 1.0,
      "minimum": 0.1,
      "maximum": 60.0,
      "ui:span": 12
    }
  },
  "required": [],
  "ui:order": [
    "app_id",
    "app_secret",
    "receive_id",
    "receive_id_type",
    "event_config",
    "enable_on_tool_call",
    "enable_on_task_complete",
    "enable_on_error",
    "render_mode",
    "max_retries",
    "retry_delay"
  ]
}
